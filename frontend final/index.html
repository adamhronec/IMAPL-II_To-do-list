<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>To-Do List - Simul치tor</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    input, textarea {
      width: 70%;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 0.5rem;
    }

    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      background-color: #4caf50;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-top: 0.5rem;
    }

    button:hover {
      background-color: #808080;
    }

    ul {
      list-style: none;
      padding: 0;
      margin-top: 1rem;
    }

    li {
      background: #fff;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .description, .due-date {
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.3rem;
    }

    .completed {
      background-color: #d4edda;
    }

    #loginSection {
      text-align: center;
      margin-bottom: 2rem;
    }

    .actions {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .delete-btn {
      background-color: #AA2F33;
    }

    .edit-btn {
      background-color: #1976d2;
    }

    .complete-btn {
      background-color: #388e3c;
    }
  </style>
</head>
<body>
  <h1>游닇 M칪j To-Do List (Simul치tor)</h1>

  <!-- Login sekcia -->
  <div id="loginSection">
    <input type="text" id="menoPouzivatela" placeholder="Zadaj svoje meno *" required>
    <br>
    <button onclick="prihlasitSa()">Prihl치si콘 sa</button>
  </div>

  <!-- Prid치vanie 칰loh -->
  <div id="taskSection" style="text-align: center; display: none;">
    <input type="text" id="novaUloha" placeholder="Zadaj n치zov 칰lohy *" required>
    <br>
    <textarea id="popisUlohy" placeholder="Zadaj popis 칰lohy (nepovinn칠)"></textarea>
    <br>
    <input type="date" id="doKedy">
    <br>
    <button onclick="pridajUlohu()">Prida콘 칰lohu</button>
  </div>

  <!-- Zoznam 칰loh -->
  <ul id="ulohyZoznam"></ul>

  <script>
    let aktualnyPouzivatel = null;

    function prihlasitSa() {
      const meno = document.getElementById("menoPouzivatela").value.trim();
      if (!meno) {
        alert("Pros칤m, zadaj svoje meno!");
        return;
      }
      aktualnyPouzivatel = meno;
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("taskSection").style.display = "block";
      nacitajUlohy();
    }

    async function nacitajUlohy() {
      try {
        const res = await fetch(`http://127.0.0.1:5000/ulohy?user_name=${encodeURIComponent(aktualnyPouzivatel)}`);
        const data = await res.json();
        renderUlohy(data);
      } catch (err) {
        console.error("Chyba pri na캜칤tan칤 칰loh:", err);
      }
    }

    async function pridajUlohu() {
      const text = document.getElementById("novaUloha").value.trim();
      const description = document.getElementById("popisUlohy").value.trim();
      const due_date = document.getElementById("doKedy").value;

      if (!text) {
        alert("N치zov 칰lohy je povinn칳!");
        return;
      }

      try {
        await fetch("http://127.0.0.1:5000/ulohy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            text,
            description,
            due_date,
            done: false,
            user_name: aktualnyPouzivatel
          })
        });

        document.getElementById("novaUloha").value = "";
        document.getElementById("popisUlohy").value = "";
        document.getElementById("doKedy").value = "";
        nacitajUlohy();
      } catch (err) {
        console.error("Chyba pri prid치van칤 칰lohy:", err);
      }
    }

    function renderUlohy(data) {
      const zoznam = document.getElementById("ulohyZoznam");
      zoznam.innerHTML = "";
      data.forEach(uloha => {
        const li = document.createElement("li");
        if (uloha.done) li.classList.add("completed");

        const text = document.createElement("div");
        text.textContent = uloha.text;
        li.appendChild(text);

        if (uloha.description) {
          const desc = document.createElement("div");
          desc.textContent = uloha.description;
          desc.className = "description";
          li.appendChild(desc);
        }

        if (uloha.due_date) {
          const due = document.createElement("div");
          due.textContent = `Do: ${uloha.due_date}`;
          due.className = "due-date";
          li.appendChild(due);
        }

        const actions = document.createElement("div");
        actions.className = "actions";

        const completeBtn = document.createElement("button");
        completeBtn.className = "complete-btn";
        completeBtn.textContent = uloha.done ? "Zru코i콘 splnenie" : "Splnen칠";
        completeBtn.onclick = () => toggleDone(uloha);

        const editBtn = document.createElement("button");
        editBtn.className = "edit-btn";
        editBtn.textContent = "Upravi콘";
        editBtn.onclick = () => upravUlohu(uloha);

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "Zmaza콘";
        deleteBtn.onclick = () => zmazUlohu(uloha.id);

        actions.appendChild(completeBtn);
        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);

        li.appendChild(actions);
        zoznam.appendChild(li);
      });
    }

    async function toggleDone(uloha) {
      try {
        await fetch(`http://127.0.0.1:5000/ulohy/${uloha.id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            text: uloha.text,
            description: uloha.description,
            due_date: uloha.due_date,
            done: !uloha.done
          })
        });
        nacitajUlohy();
      } catch (err) {
        console.error("Chyba pri aktualiz치cii 칰lohy:", err);
      }
    }

    async function upravUlohu(uloha) {
      const novyText = prompt("Uprav n치zov 칰lohy:", uloha.text);
      const novyPopis = prompt("Uprav popis 칰lohy:", uloha.description || "");
      const novyDatum = prompt("Uprav d치tum (rrrr-mm-dd):", uloha.due_date || "");

      if (!novyText) return;

      try {
        await fetch(`http://127.0.0.1:5000/ulohy/${uloha.id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            text: novyText,
            description: novyPopis,
            due_date: novyDatum,
            done: uloha.done
          })
        });
        nacitajUlohy();
      } catch (err) {
        console.error("Chyba pri 칰prave 칰lohy:", err);
      }
    }

    async function zmazUlohu(id) {
      try {
        await fetch(`http://127.0.0.1:5000/ulohy/${id}`, {
          method: "DELETE"
        });
        nacitajUlohy();
      } catch (err) {
        console.error("Chyba pri mazan칤 칰lohy:", err);
      }
    }
  </script>
</body>
</html>

